version: 1.0.{build}

branches:
  only:
    - 4.2.5

image: Visual Studio 2017

environment:
  matrix:
    - platform: win32
      ARCH: win32-msvc14
      configuration: Release
      CMAKE_GENERATOR: "Visual Studio 14 2015"
      MSVCVERSION: "%MSVCVERSION%"
      MSVCYEAR: "vs2015"
      MSVCABR: "14"
      VC_VER: 14.0
      PYTHONPATH: c:\Python35\
      WITH_SODIUM: OFF
    - platform: x64
      ARCH: x64-msvc15
      configuration: Release
      CMAKE_GENERATOR: "Visual Studio 15 2017 Win64"
      MSVCVERSION: "%MSVCVERSION%"
      MSVCYEAR: "vs2017"
      MSVCABR: "15"
      VC_VER: 15.0
      PYTHONPATH: c:\Python35-x64\
      WITH_SODIUM: OFF
    - platform: win32
      ARCH: win32-msvc15
      configuration: Release
      CMAKE_GENERATOR: "Visual Studio 15 2017"
      MSVCVERSION: "%MSVCVERSION%"
      MSVCYEAR: "vs2017"
      MSVCABR: "15"
      VC_VER: 15.0
      PYTHONPATH: c:\Python35\
      WITH_SODIUM: OFF
    - platform: x64
      ARCH: x64-msvc14
      configuration: Release
      CMAKE_GENERATOR: "Visual Studio 14 2015 Win64"
      MSVCVERSION: "%MSVCVERSION%"
      MSVCYEAR: "vs2015"
      MSVCABR: "14"
      VC_VER: 14.0
      PYTHONPATH: c:\Python35-x64\
      WITH_SODIUM: OFF

init:
  #RDP from start
  #- ps: iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))
  # ZMQ
  #- cmd: set LIBZMQ_SOURCEDIR=C:\projects\libzmq
  - cmd: set LIBZMQ_SOURCEDIR=C:\projects\zeromq-4.2.5
  #- cmd: git clone --depth 1 --quiet https://github.com/zeromq/libzmq.git "%LIBZMQ_SOURCEDIR%"
  #- cmd: git clone --depth 1 --quiet https://github.com/zeromq/zeromq4-1.git "%LIBZMQ_SOURCEDIR%"
  #- cmd: git clone --depth 1 --quiet https://github.com/zeromq/zeromq4-x.git "%LIBZMQ_SOURCEDIR%"
  - cmd: cd C:\projects\
  - appveyor DownloadFile "https://github.com/zeromq/libzmq/releases/download/v4.2.5/zeromq-4.2.5.zip"
  - cmd: dir
  - cmd: 7z -y x zeromq-4.2.5.zip
  - cmd: cd "%LIBZMQ_SOURCEDIR%"
  - cmd: set ZMQHPPDIR=C:\projects\zmq
  - cmd: git clone --depth 1 --quiet https://github.com/zeromq/cppzmq.git %ZMQHPPDIR%
  #Pthread-Win32
  - cmd: cd "C:\projects\"
  - cmd: md pthreads-win32
  - cmd: cd "C:\projects\"
  - appveyor DownloadFile "http://www.mirrorservice.org/sites/sources.redhat.com/pub/pthreads-win32/pthreads-w32-2-9-1-release.zip"
  - cmd: 7z -y x pthreads-w32-2-9-1-release.zip -oC:\projects\pthreads-win32\
  - cmd: cd "C:\projects\"
  - cmd: ls -la
  - cmd: cd "C:\projects\zmq-windows-ci-0pjfi"
  
install:
#  - cmd: move /Y C:\projects\zmq-windows-ci-0pjfi\patch\libzmq.vcxproj "%LIBZMQ_SOURCEDIR%"\builds\msvc\vs2015\libzmq\libzmq.vcxproj
  - cmd: if %ARCH%==win32-msvc14 call "C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\vcvarsall.bat"
  - cmd: if %ARCH%==win32-msvc15 call "C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\VC\Auxiliary\Build\vcvars32.bat"
  - cmd: if %ARCH%==x64-msvc14 call "C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\vcvarsall.bat" x64
  - cmd: if %ARCH%==x64-msvc15 call "C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\VC\Auxiliary\Build\vcvars64.bat"
  - cmd: echo "Generator='%CMAKE_GENERATOR%'"
  - cmd: echo "Platform='%Platform%'"
  - cmd: set PYTHONPATH=%PYTHONPATH%
  # Zmq
  - cmd: set LIBZMQ_BUILDDIR=C:\projects\build_libzmq
  - cmd: md "%LIBZMQ_BUILDDIR%"
  - cmd: cd "%LIBZMQ_BUILDDIR%"
  - cmd: set ZEROMQ_INCLUDE_DIR="%LIBZMQ_SOURCEDIR%\include"

build_script:
  - cmd: cd "%LIBZMQ_SOURCEDIR%"

  - ps:  (get-content ${env:LIBZMQ_SOURCEDIR}\builds\msvc\vs2015\libzmq.import.props) | foreach-object {$_ -replace "\\\.\.\\libzmq", "\\\.\."} | set-content ${env:LIBZMQ_SOURCEDIR}\builds\msvc\vs2015\libzmq.import.props
  - cmd: if %ARCH%==win32-msvc14 msbuild builds\msvc\vs2015\libzmq.sln /p:Configuration="DynDebug" /p:PlatformToolset=%MSVCVERSION%
  - cmd: md bin\Debug
  - cmd: md lib\Debug
  - cmd: if %ARCH%==win32-msvc14 move "%LIBZMQ_SOURCEDIR%"\bin\Win32\Debug\%MSVCVERSION%\dynamic\libzmq.exp "%LIBZMQ_SOURCEDIR%"\lib\Debug\libzmq-%MSVCVERSION%-mt-gd-4_2_5.exp
  - cmd: if %ARCH%==win32-msvc14 move "%LIBZMQ_SOURCEDIR%"\bin\Win32\Debug\%MSVCVERSION%\dynamic\libzmq.dll "%LIBZMQ_SOURCEDIR%"\bin\Debug\libzmq-%MSVCVERSION%-mt-gd-4_2_5.dll
  - cmd: if %ARCH%==win32-msvc14 move "%LIBZMQ_SOURCEDIR%"\bin\Win32\Debug\%MSVCVERSION%\dynamic\libzmq.pdb "%LIBZMQ_SOURCEDIR%"\bin\Debug\libzmq-%MSVCVERSION%-mt-gd-4_2_5.pdb
  - cmd: if %ARCH%==win32-msvc14 move "%LIBZMQ_SOURCEDIR%"\bin\Win32\Debug\%MSVCVERSION%\dynamic\libzmq.lib "%LIBZMQ_SOURCEDIR%"\lib\Debug\libzmq-%MSVCVERSION%-mt-gd-4_2_5.lib
  - cmd: if %ARCH%==win32-msvc14 move "%LIBZMQ_SOURCEDIR%"\bin\Win32\Debug\%MSVCVERSION%\dynamic\*.exe "%LIBZMQ_SOURCEDIR%"\bin\Debug\
  - cmd: if %ARCH%==win32-msvc14 move "%LIBZMQ_SOURCEDIR%"\bin\Win32\Debug\%MSVCVERSION%\dynamic\*.pdb "%LIBZMQ_SOURCEDIR%"\bin\Debug\
  - cmd: if %ARCH%==win32-msvc14 msbuild builds\msvc\vs2015\libzmq.sln /p:Configuration="DynRelease" /p:PlatformToolset=%MSVCVERSION%
  - cmd: md bin\Release
  - cmd: md lib\Release
  - cmd: if %ARCH%==win32-msvc14 move "%LIBZMQ_SOURCEDIR%"\bin\Win32\Release\%MSVCVERSION%\dynamic\libzmq.exp "%LIBZMQ_SOURCEDIR%"\lib\Release\libzmq-%MSVCVERSION%-mt-4_2_5.exp
  - cmd: if %ARCH%==win32-msvc14 move "%LIBZMQ_SOURCEDIR%"\bin\Win32\Release\%MSVCVERSION%\dynamic\libzmq.dll "%LIBZMQ_SOURCEDIR%"\bin\Release\libzmq-%MSVCVERSION%-mt-4_2_5.dll
  - cmd: if %ARCH%==win32-msvc14 move "%LIBZMQ_SOURCEDIR%"\bin\Win32\Release\%MSVCVERSION%\dynamic\libzmq.pdb "%LIBZMQ_SOURCEDIR%"\bin\Release\libzmq-%MSVCVERSION%-mt-4_2_5.pdb
  - cmd: if %ARCH%==win32-msvc14 move "%LIBZMQ_SOURCEDIR%"\bin\Win32\Release\%MSVCVERSION%\dynamic\libzmq.lib "%LIBZMQ_SOURCEDIR%"\lib\Release\libzmq-%MSVCVERSION%-mt-4_2_5.lib
  - cmd: if %ARCH%==win32-msvc14 move "%LIBZMQ_SOURCEDIR%"\bin\Win32\Release\%MSVCVERSION%\dynamic\*.exe "%LIBZMQ_SOURCEDIR%"\bin\Release\
  - cmd: if %ARCH%==win32-msvc14 move "%LIBZMQ_SOURCEDIR%"\bin\Win32\Release\%MSVCVERSION%\dynamic\*.pdb "%LIBZMQ_SOURCEDIR%"\bin\Release\
  - cmd: if %ARCH%==win32-msvc14 msbuild builds\msvc\vs2015\libzmq.sln /t:libzmq /p:Configuration="StaticDebug" /p:PlatformToolset=%MSVCVERSION%
  - cmd: if %ARCH%==win32-msvc14 move "%LIBZMQ_SOURCEDIR%"\bin\Win32\Debug\%MSVCVERSION%\static\libzmq.lib "%LIBZMQ_SOURCEDIR%"\lib\Debug\libzmq-%MSVCVERSION%-mt-sgd-4_2_5.lib
  - cmd: if %ARCH%==win32-msvc14 msbuild builds\msvc\vs2015\libzmq.sln /t:libzmq /p:Configuration="StaticRelease" /p:PlatformToolset=%MSVCVERSION%
  - cmd: if %ARCH%==win32-msvc14 move "%LIBZMQ_SOURCEDIR%"\bin\Win32\Release\%MSVCVERSION%\static\libzmq.lib "%LIBZMQ_SOURCEDIR%"\lib\Release\libzmq-%MSVCVERSION%-mt-s-4_2_5.lib
  - cmd: if %ARCH%==win32-msvc14 RD /S /Q "%LIBZMQ_SOURCEDIR%"\bin\Win32

  - cmd: if %ARCH%==win32-msvc15 msbuild builds\msvc\vs2015\libzmq.sln /p:Configuration="DynDebug" /p:PlatformToolset=%MSVCVERSION%
  - cmd: md bin\Debug
  - cmd: md lib\Debug
  - cmd: if %ARCH%==win32-msvc15 move "%LIBZMQ_SOURCEDIR%"\bin\Win32\Debug\%MSVCVERSION%\dynamic\libzmq.exp "%LIBZMQ_SOURCEDIR%"\lib\Debug\libzmq-%MSVCVERSION%-mt-gd-4_2_5.exp
  - cmd: if %ARCH%==win32-msvc15 move "%LIBZMQ_SOURCEDIR%"\bin\Win32\Debug\%MSVCVERSION%\dynamic\libzmq.dll "%LIBZMQ_SOURCEDIR%"\bin\Debug\libzmq-%MSVCVERSION%-mt-gd-4_2_5.dll
  - cmd: if %ARCH%==win32-msvc15 move "%LIBZMQ_SOURCEDIR%"\bin\Win32\Debug\%MSVCVERSION%\dynamic\libzmq.pdb "%LIBZMQ_SOURCEDIR%"\bin\Debug\libzmq-%MSVCVERSION%-mt-gd-4_2_5.pdb
  - cmd: if %ARCH%==win32-msvc15 move "%LIBZMQ_SOURCEDIR%"\bin\Win32\Debug\%MSVCVERSION%\dynamic\libzmq.lib "%LIBZMQ_SOURCEDIR%"\lib\Debug\libzmq-%MSVCVERSION%-mt-gd-4_2_5.lib
  - cmd: if %ARCH%==win32-msvc15 move "%LIBZMQ_SOURCEDIR%"\bin\Win32\Debug\%MSVCVERSION%\dynamic\*.exe "%LIBZMQ_SOURCEDIR%"\bin\Debug\
  - cmd: if %ARCH%==win32-msvc15 move "%LIBZMQ_SOURCEDIR%"\bin\Win32\Debug\%MSVCVERSION%\dynamic\*.pdb "%LIBZMQ_SOURCEDIR%"\bin\Debug\
  - cmd: if %ARCH%==win32-msvc15 msbuild builds\msvc\vs2015\libzmq.sln /p:Configuration="DynRelease" /p:PlatformToolset=%MSVCVERSION%
  - cmd: md bin\Release
  - cmd: md lib\Release
  - cmd: if %ARCH%==win32-msvc15 move "%LIBZMQ_SOURCEDIR%"\bin\Win32\Release\%MSVCVERSION%\dynamic\libzmq.exp "%LIBZMQ_SOURCEDIR%"\lib\Release\libzmq-%MSVCVERSION%-mt-4_2_5.exp
  - cmd: if %ARCH%==win32-msvc15 move "%LIBZMQ_SOURCEDIR%"\bin\Win32\Release\%MSVCVERSION%\dynamic\libzmq.dll "%LIBZMQ_SOURCEDIR%"\bin\Release\libzmq-%MSVCVERSION%-mt-4_2_5.dll
  - cmd: if %ARCH%==win32-msvc15 move "%LIBZMQ_SOURCEDIR%"\bin\Win32\Release\%MSVCVERSION%\dynamic\libzmq.pdb "%LIBZMQ_SOURCEDIR%"\bin\Release\libzmq-%MSVCVERSION%-mt-4_2_5.pdb
  - cmd: if %ARCH%==win32-msvc15 move "%LIBZMQ_SOURCEDIR%"\bin\Win32\Release\%MSVCVERSION%\dynamic\libzmq.lib "%LIBZMQ_SOURCEDIR%"\lib\Release\libzmq-%MSVCVERSION%-mt-4_2_5.lib
  - cmd: if %ARCH%==win32-msvc15 move "%LIBZMQ_SOURCEDIR%"\bin\Win32\Release\%MSVCVERSION%\dynamic\*.exe "%LIBZMQ_SOURCEDIR%"\bin\Release\
  - cmd: if %ARCH%==win32-msvc15 move "%LIBZMQ_SOURCEDIR%"\bin\Win32\Release\%MSVCVERSION%\dynamic\*.pdb "%LIBZMQ_SOURCEDIR%"\bin\Release\
  - cmd: if %ARCH%==win32-msvc15 msbuild builds\msvc\vs2015\libzmq.sln /t:libzmq /p:Configuration="StaticDebug" /p:PlatformToolset=%MSVCVERSION%
  - cmd: if %ARCH%==win32-msvc15 move "%LIBZMQ_SOURCEDIR%"\bin\Win32\Debug\%MSVCVERSION%\static\libzmq.lib "%LIBZMQ_SOURCEDIR%"\lib\Debug\libzmq-%MSVCVERSION%-mt-sgd-4_2_5.lib
  - cmd: if %ARCH%==win32-msvc15 msbuild builds\msvc\vs2015\libzmq.sln /t:libzmq /p:Configuration="StaticRelease" /p:PlatformToolset=%MSVCVERSION%
  - cmd: if %ARCH%==win32-msvc15 move "%LIBZMQ_SOURCEDIR%"\bin\Win32\Release\%MSVCVERSION%\static\libzmq.lib "%LIBZMQ_SOURCEDIR%"\lib\Release\libzmq-%MSVCVERSION%-mt-s-4_2_5.lib
  - cmd: if %ARCH%==win32-msvc15 RD /S /Q "%LIBZMQ_SOURCEDIR%"\bin\Win32
    
  - cmd: if %ARCH%==x64-msvc14 msbuild builds\msvc\vs2015\libzmq.sln /p:Configuration="DynDebug" /p:PlatformToolset=%MSVCVERSION%
  - cmd: md bin\Debug
  - cmd: md lib\Debug
  - cmd: if %ARCH%==x64-msvc14 move "%LIBZMQ_SOURCEDIR%"\bin\x64\Debug\%MSVCVERSION%\dynamic\libzmq.exp "%LIBZMQ_SOURCEDIR%"\lib\Debug\libzmq-%MSVCVERSION%-mt-gd-4_2_5.exp
  - cmd: if %ARCH%==x64-msvc14 move "%LIBZMQ_SOURCEDIR%"\bin\x64\Debug\%MSVCVERSION%\dynamic\libzmq.dll "%LIBZMQ_SOURCEDIR%"\bin\Debug\libzmq-%MSVCVERSION%-mt-gd-4_2_5.dll
  - cmd: if %ARCH%==x64-msvc14 move "%LIBZMQ_SOURCEDIR%"\bin\x64\Debug\%MSVCVERSION%\dynamic\libzmq.pdb "%LIBZMQ_SOURCEDIR%"\bin\Debug\libzmq-%MSVCVERSION%-mt-gd-4_2_5.pdb
  - cmd: if %ARCH%==x64-msvc14 move "%LIBZMQ_SOURCEDIR%"\bin\x64\Debug\%MSVCVERSION%\dynamic\libzmq.lib "%LIBZMQ_SOURCEDIR%"\lib\Debug\libzmq-%MSVCVERSION%-mt-gd-4_2_5.lib
  - cmd: if %ARCH%==x64-msvc14 move "%LIBZMQ_SOURCEDIR%"\bin\x64\Debug\%MSVCVERSION%\dynamic\*.exe "%LIBZMQ_SOURCEDIR%"\bin\Debug\
  - cmd: if %ARCH%==x64-msvc14 move "%LIBZMQ_SOURCEDIR%"\bin\x64\Debug\%MSVCVERSION%\dynamic\*.pdb "%LIBZMQ_SOURCEDIR%"\bin\Debug\
  - cmd: if %ARCH%==x64-msvc14 msbuild builds\msvc\vs2015\libzmq.sln /p:Configuration="DynRelease" /p:PlatformToolset=%MSVCVERSION%
  - cmd: md bin\Release
  - cmd: md lib\Release
  - cmd: if %ARCH%==x64-msvc14 move "%LIBZMQ_SOURCEDIR%"\bin\x64\Release\%MSVCVERSION%\dynamic\libzmq.exp "%LIBZMQ_SOURCEDIR%"\lib\Release\libzmq-%MSVCVERSION%-mt-4_2_5.exp
  - cmd: if %ARCH%==x64-msvc14 move "%LIBZMQ_SOURCEDIR%"\bin\x64\Release\%MSVCVERSION%\dynamic\libzmq.dll "%LIBZMQ_SOURCEDIR%"\bin\Release\libzmq-%MSVCVERSION%-mt-4_2_5.dll
  - cmd: if %ARCH%==x64-msvc14 move "%LIBZMQ_SOURCEDIR%"\bin\x64\Release\%MSVCVERSION%\dynamic\libzmq.pdb "%LIBZMQ_SOURCEDIR%"\bin\Release\libzmq-%MSVCVERSION%-mt-4_2_5.pdb
  - cmd: if %ARCH%==x64-msvc14 move "%LIBZMQ_SOURCEDIR%"\bin\x64\Release\%MSVCVERSION%\dynamic\libzmq.lib "%LIBZMQ_SOURCEDIR%"\lib\Release\libzmq-%MSVCVERSION%-mt-4_2_5.lib
  - cmd: if %ARCH%==x64-msvc14 move "%LIBZMQ_SOURCEDIR%"\bin\x64\Release\%MSVCVERSION%\dynamic\*.exe "%LIBZMQ_SOURCEDIR%"\bin\Release\
  - cmd: if %ARCH%==x64-msvc14 move "%LIBZMQ_SOURCEDIR%"\bin\x64\Release\%MSVCVERSION%\dynamic\*.pdb "%LIBZMQ_SOURCEDIR%"\bin\Release\
  - cmd: if %ARCH%==x64-msvc14 msbuild builds\msvc\vs2015\libzmq.sln /t:libzmq /p:Configuration="StaticDebug" /p:PlatformToolset=%MSVCVERSION%
  - cmd: if %ARCH%==x64-msvc14 move "%LIBZMQ_SOURCEDIR%"\bin\x64\Debug\%MSVCVERSION%\static\libzmq.lib "%LIBZMQ_SOURCEDIR%"\lib\Debug\libzmq-%MSVCVERSION%-mt-sgd-4_2_5.lib
  - cmd: if %ARCH%==x64-msvc14 msbuild builds\msvc\vs2015\libzmq.sln /t:libzmq /p:Configuration="StaticRelease" /p:PlatformToolset=%MSVCVERSION%
  - cmd: if %ARCH%==x64-msvc14 move "%LIBZMQ_SOURCEDIR%"\bin\x64\Release\%MSVCVERSION%\static\libzmq.lib "%LIBZMQ_SOURCEDIR%"\lib\Release\libzmq-%MSVCVERSION%-mt-s-4_2_5.lib
  - cmd: if %ARCH%==x64-msvc14 RD /S /Q "%LIBZMQ_SOURCEDIR%"\bin\x64

  - cmd: if %ARCH%==x64-msvc15 msbuild builds\msvc\vs2015\libzmq.sln /p:Configuration="DynDebug" /p:PlatformToolset=%MSVCVERSION%
  - cmd: md bin\Debug
  - cmd: md lib\Debug
  - cmd: if %ARCH%==x64-msvc15 move "%LIBZMQ_SOURCEDIR%"\bin\x64\Debug\%MSVCVERSION%\dynamic\libzmq.exp "%LIBZMQ_SOURCEDIR%"\lib\Debug\libzmq-%MSVCVERSION%-mt-gd-4_2_5.exp
  - cmd: if %ARCH%==x64-msvc15 move "%LIBZMQ_SOURCEDIR%"\bin\x64\Debug\%MSVCVERSION%\dynamic\libzmq.dll "%LIBZMQ_SOURCEDIR%"\bin\Debug\libzmq-%MSVCVERSION%-mt-gd-4_2_5.dll
  - cmd: if %ARCH%==x64-msvc15 move "%LIBZMQ_SOURCEDIR%"\bin\x64\Debug\%MSVCVERSION%\dynamic\libzmq.pdb "%LIBZMQ_SOURCEDIR%"\bin\Debug\libzmq-%MSVCVERSION%-mt-gd-4_2_5.pdb
  - cmd: if %ARCH%==x64-msvc15 move "%LIBZMQ_SOURCEDIR%"\bin\x64\Debug\%MSVCVERSION%\dynamic\libzmq.lib "%LIBZMQ_SOURCEDIR%"\lib\Debug\libzmq-%MSVCVERSION%-mt-gd-4_2_5.lib
  - cmd: if %ARCH%==x64-msvc15 move "%LIBZMQ_SOURCEDIR%"\bin\x64\Debug\%MSVCVERSION%\dynamic\*.exe "%LIBZMQ_SOURCEDIR%"\bin\Debug\
  - cmd: if %ARCH%==x64-msvc15 move "%LIBZMQ_SOURCEDIR%"\bin\x64\Debug\%MSVCVERSION%\dynamic\*.pdb "%LIBZMQ_SOURCEDIR%"\bin\Debug\
  - cmd: if %ARCH%==x64-msvc15 msbuild builds\msvc\vs2015\libzmq.sln /p:Configuration="DynRelease" /p:PlatformToolset=%MSVCVERSION%
  - cmd: md bin\Release
  - cmd: md lib\Release
  - cmd: if %ARCH%==x64-msvc15 move "%LIBZMQ_SOURCEDIR%"\bin\x64\Release\%MSVCVERSION%\dynamic\libzmq.exp "%LIBZMQ_SOURCEDIR%"\lib\Release\libzmq-%MSVCVERSION%-mt-4_2_5.exp
  - cmd: if %ARCH%==x64-msvc15 move "%LIBZMQ_SOURCEDIR%"\bin\x64\Release\%MSVCVERSION%\dynamic\libzmq.dll "%LIBZMQ_SOURCEDIR%"\bin\Release\libzmq-%MSVCVERSION%-mt-4_2_5.dll
  - cmd: if %ARCH%==x64-msvc15 move "%LIBZMQ_SOURCEDIR%"\bin\x64\Release\%MSVCVERSION%\dynamic\libzmq.pdb "%LIBZMQ_SOURCEDIR%"\bin\Release\libzmq-%MSVCVERSION%-mt-4_2_5.pdb
  - cmd: if %ARCH%==x64-msvc15 move "%LIBZMQ_SOURCEDIR%"\bin\x64\Release\%MSVCVERSION%\dynamic\libzmq.lib "%LIBZMQ_SOURCEDIR%"\lib\Release\libzmq-%MSVCVERSION%-mt-4_2_5.lib
  - cmd: if %ARCH%==x64-msvc15 move "%LIBZMQ_SOURCEDIR%"\bin\x64\Release\%MSVCVERSION%\dynamic\*.exe "%LIBZMQ_SOURCEDIR%"\bin\Release\
  - cmd: if %ARCH%==x64-msvc15 move "%LIBZMQ_SOURCEDIR%"\bin\x64\Release\%MSVCVERSION%\dynamic\*.pdb "%LIBZMQ_SOURCEDIR%"\bin\Release\
  - cmd: if %ARCH%==x64-msvc15 msbuild builds\msvc\vs2015\libzmq.sln /t:libzmq /p:Configuration="StaticDebug" /p:PlatformToolset=%MSVCVERSION%
  - cmd: if %ARCH%==x64-msvc15 move "%LIBZMQ_SOURCEDIR%"\bin\x64\Debug\%MSVCVERSION%\static\libzmq.lib "%LIBZMQ_SOURCEDIR%"\lib\Debug\libzmq-%MSVCVERSION%-mt-sgd-4_2_5.lib
  - cmd: if %ARCH%==x64-msvc15 msbuild builds\msvc\vs2015\libzmq.sln /t:libzmq /p:Configuration="StaticRelease" /p:PlatformToolset=%MSVCVERSION%
  - cmd: if %ARCH%==x64-msvc15 move "%LIBZMQ_SOURCEDIR%"\bin\x64\Release\%MSVCVERSION%\static\libzmq.lib "%LIBZMQ_SOURCEDIR%"\lib\Release\libzmq-%MSVCVERSION%-mt-s-4_2_5.lib
  - cmd: if %ARCH%==x64-msvc15 RD /S /Q "%LIBZMQ_SOURCEDIR%"\bin\x64
after_build:
  - cmd: move "%ZMQHPPDIR%\zmq.hpp" "%LIBZMQ_SOURCEDIR%\include\"
  - cmd: move "%ZMQHPPDIR%\zmq_addon.hpp" "%LIBZMQ_SOURCEDIR%\include\"
  - cmd: cd "C:\projects\"
  # Generating zip
  - cmd: 7z a zmq-4.2.5_%ARCH%.zip %LIBZMQ_SOURCEDIR%\include\
  - cmd: 7z a zmq-4.2.5_%ARCH%.zip %LIBZMQ_SOURCEDIR%\lib\
  - cmd: 7z a zmq-4.2.5_%ARCH%.zip %LIBZMQ_SOURCEDIR%\bin\
  - cmd: copy zmq-4.2.5_%ARCH%.zip C:\projects\zmq-windows-ci-0pjfi\

on_finish:
  #RDP for finish
  #- ps: $blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))

artifacts:
  - path: .\zmq-4.2.5_*.zip
 
